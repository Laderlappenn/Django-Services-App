
<div class="upvotes">
<button class="upvote" id="buttonTrue">Vote Up</button>
<span class="count" id="voteCount">{{ votes }}</span>
<button class="downvote" id="buttonFalse">Vote Down</button>
</div>



<style>
  /* Button Styles */
  .voteButton {
    background-color: #ff4500; /* Reddit orange */
    color: #ffffff;
    border: none;
    padding: 10px 20px;
    cursor: pointer;
    border-radius: 5px;
    font-size: 16px;
    margin-right: 10px;
    outline: none;
  }

  .voteButton:hover {
    background-color: #ff5722; /* Darker shade of orange */
  }

  /* Vote Count Styles */
  #voteCount {
    font-size: 14px;
    color: #666666;
    margin-top: 10px;
  }




  div.upvotes {
  text-align: center;
}

div.upvotes button {
  cursor: default;
  color: transparent;
  background-image: url('https://janosgyerik.github.io/upvotejs/dist/upvotejs/upvotejs.svg?v=1');
  background-repeat: no-repeat;
  overflow: hidden;
  display: block;
  margin: 0 auto;
  margin-bottom: 2px;
  width: 40px;
  height: 30px;
  border-width: 0;
  background-color: transparent;
}

div.upvotes-enabled button {
  cursor: pointer;
}

div.upvotes span.count {
  display: block;
  text-align: center;
  font-size: 20px;
  font-family: Arial, "Helvetica Neue", Helvetica, sans-serif;
  color: #6a737c;
  margin: 8px 0;
}

div.upvotes button.upvote {
  background-position: 0px -170px;
}

div.upvotes button.upvote.active {
  background-position: -40px -170px;
}

div.upvotes button.downvote {
  background-position: 0px -220px;
}

div.upvotes button.downvote.active {
  background-position: -40px -220px;
}

div.upvotes button.star {
  background-position: 0px -120px;
}

div.upvotes button.star.star-on {
  background-position: -40px -120px;
}

div.upvotes-unix button.upvote.active, div.upvotes-unix button.active {
  filter: invert(.5) sepia(1) hue-rotate(165.7518582deg)  saturate(3.8235864)  hue-rotate(-0.81675376deg)  brightness(.47739161);
}

div.upvotes-serverfault button.upvote.active, div.upvotes-serverfault button.active {
  filter: invert(.5) sepia(1) hue-rotate(315.5792014deg) saturate(7.91709017) hue-rotate(346.04745219deg) brightness(.57640233);
}

div.upvotes-superuser button.upvote.active, div.upvotes-superuser button.active {
  filter: invert(.5) sepia(1) hue-rotate(159.50943396deg) saturate(2.94246645) hue-rotate(-4.96258652deg) brightness(.925639);
}










</style>

<script>
  var current_vote;
<!-- TODO: переделать current_button с EventListener -->
  var current_button;
  var voteCount = {{ votes|default_if_none:"0" }};
  var voted;


// Инициализация начального состояния кнопки
  if ("{{ vote_value|lower }}" == "none") {
    voted = null;
    current_vote = null;
  } else {
    voted = {{ vote_value|lower }};
    current_vote = {{ vote_value|lower }};
    if (current_vote) {
      document.getElementById('buttonTrue').classList.add('active');
    } else {
      document.getElementById('buttonFalse').classList.add('active');
    }
  }

// Функция для отправки запроса и увеличения voteCount, если состояние кнопки отличается от active, то выход из функции
function handleClick(voteValue) {
    if (current_button.classList.contains('active')) {
      return;
    }

    let url = '{% url 'vote:ad_vote' ad_id=ad.id %}';


    if (!document.getElementById('buttonTrue').classList.contains('active') && !document.getElementById('buttonFalse').classList.contains('active')) {
        voteCount++;
        if (voteValue) {
            document.getElementById('buttonTrue').classList.add('active');
            document.getElementById('buttonFalse').classList.remove('active');
        } else {
            document.getElementById('buttonTrue').classList.remove('active');
            document.getElementById('buttonFalse').classList.add('active');
        }
    }
    else {
        if (voteValue) {
            voteCount = voteCount+2;
            document.getElementById('buttonTrue').classList.add('active');
            document.getElementById('buttonFalse').classList.remove('active');
        } else {
            voteCount = voteCount-2;
            document.getElementById('buttonTrue').classList.remove('active');
            document.getElementById('buttonFalse').classList.add('active');
        }
    }



    // Создание объекта запроса
    const requestOptions = {
      method: 'POST',
      headers: {
        'X-CSRFToken': '{{ csrf_token }}',
        'voted': voteValue
      }
    };

    // Отправка POST запроса с помощью Fetch API
    fetch(url, requestOptions)
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
      });

    document.getElementById('voteCount').textContent = voteCount;
  }

  // Обработчики событий для кнопок
  document.getElementById('buttonTrue').addEventListener('click', function() {
    current_button = document.getElementById('buttonTrue');
    handleClick(true);
  });

  document.getElementById('buttonFalse').addEventListener('click', function() {
    current_button = document.getElementById('buttonFalse');
    handleClick(false);
  });

  document.getElementById('voteCount').textContent = voteCount;
</script>
